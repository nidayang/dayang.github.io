<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>设计模式之七大设计原则</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9825735b.css" as="style"><link rel="preload" href="/assets/js/app.dec1967b.js" as="script"><link rel="preload" href="/assets/js/2.9efafe32.js" as="script"><link rel="preload" href="/assets/js/11.9f783c45.js" as="script"><link rel="prefetch" href="/assets/js/10.075c937d.js"><link rel="prefetch" href="/assets/js/12.028f3a58.js"><link rel="prefetch" href="/assets/js/13.911bd29d.js"><link rel="prefetch" href="/assets/js/14.0f912e52.js"><link rel="prefetch" href="/assets/js/15.be8d5516.js"><link rel="prefetch" href="/assets/js/16.0c8303bd.js"><link rel="prefetch" href="/assets/js/3.89a35d8a.js"><link rel="prefetch" href="/assets/js/4.6e92b036.js"><link rel="prefetch" href="/assets/js/5.4d3a910a.js"><link rel="prefetch" href="/assets/js/6.b62b23e4.js"><link rel="prefetch" href="/assets/js/7.4fb8bec6.js"><link rel="prefetch" href="/assets/js/8.80acf0fe.js"><link rel="prefetch" href="/assets/js/9.5bfd371b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9825735b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="结构型设计模式之代理模式"><a href="#结构型设计模式之代理模式" class="header-anchor">#</a> 结构型设计模式之代理模式</h1> <blockquote><p>参考博客（其中视频是看的尚硅谷 B 站视频）</p></blockquote> <blockquote><p>()[https://www.cnblogs.com/clover-toeic/p/11715583.html]</p></blockquote> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <p>给目标对象提供一个替身或者占位符以==控制==对这个对象的访问。</p> <p>注意：最后还是<strong>访问的是目标对象的方法</strong>。</p> <h2 id="静态代理"><a href="#静态代理" class="header-anchor">#</a> 静态代理</h2> <p>代理对象和目标对象都实现相同的接口，代理对象的构造函数中传入目标对象。</p> <p><img src="https://dyimgstorage-1304967922.cos.ap-nanjing.myqcloud.com/mdimg/image-20220603184120440.png" alt="image-20220603184120440"></p> <h3 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h3> <h4 id="iteacherdao"><a href="#iteacherdao" class="header-anchor">#</a> ITeacherDao</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ITeacherDao</span> <span class="token punctuation">{</span>
	<span class="token keyword">void</span> <span class="token function">teach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 授课的方法</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="teacherdao"><a href="#teacherdao" class="header-anchor">#</a> TeacherDao</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherDao</span> <span class="token keyword">implements</span> <span class="token class-name">ITeacherDao</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">teach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; 老师授课中  。。。。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="teacherdaoproxy"><a href="#teacherdaoproxy" class="header-anchor">#</a> TeacherDaoProxy</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//代理对象,静态代理</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TeacherDaoProxy</span> <span class="token keyword">implements</span> <span class="token class-name">ITeacherDao</span><span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">ITeacherDao</span> target<span class="token punctuation">;</span> <span class="token comment">// 目标对象，通过接口来聚合</span>
	<span class="token comment">//构造器</span>
	<span class="token keyword">public</span> <span class="token class-name">TeacherDaoProxy</span><span class="token punctuation">(</span><span class="token class-name">ITeacherDao</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">teach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;开始代理  完成某些操作。。。。。 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		target<span class="token punctuation">.</span><span class="token function">teach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;提交。。。。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="优缺点"><a href="#优缺点" class="header-anchor">#</a> 优缺点</h4> <ul><li><p>优点：在不修改目标对象的功能前提下,能通过代理对象对目标功能扩展</p></li> <li><p>缺点：</p> <ul><li>因为代理对象需要与目标对象实现一样的接口,所以会有很多代理类</li> <li>一旦接口增加方法,目标对象与代理对象都要维护</li></ul></li></ul> <h2 id="动态代理"><a href="#动态代理" class="header-anchor">#</a> 动态代理</h2> <h4 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h4> <ul><li>代理对象,不需要实现接口，但是目标对象要实现接口，否则不能用动态代理</li> <li>代理对象的生成，是利用 JDK 的 API，<strong>动态</strong>的在内存中构建代理对象</li> <li>动态代理也叫做：JDK 代理、接口代理</li></ul> <p>主要使用==proxy==对象中的==newProxyInstance==方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> loader<span class="token punctuation">,</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">,</span><span class="token class-name">InvocationHandler</span> h<span class="token punctuation">)</span>
</code></pre></div><h4 id="自定义-invocationhandler-类"><a href="#自定义-invocationhandler-类" class="header-anchor">#</a> 自定义 InvocationHandler 类</h4> <p>不用内部类方式写代码的时候，==一定要聚合目标对象==。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">proxy<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>dynamic</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author NIDAYANG
 * @ClassName CustomInvocationHandler
 * @Description
 * @Date 2022/6/3 18:47
 * @Version 1.0.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomInvocationHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> tartget<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CustomInvocationHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> tartget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tartget <span class="token operator">=</span> tartget<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;JDK代理开始~~&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//反射机制调用目标对象的方法</span>
        <span class="token class-name">Object</span> returnVal <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>tartget<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;JDK代理提交&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> returnVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="cglib-代理"><a href="#cglib-代理" class="header-anchor">#</a> cglib 代理</h2> <h4 id="介绍-2"><a href="#介绍-2" class="header-anchor">#</a> 介绍</h4> <ul><li>静态代理和 JDK 代理模式都要求目标对象是实现一个接口,但是有时候目标对象只是一个单独的对象,并没有实现任何的接口,这个时候可使用目标对象子类来实现代理-这就是 Cglib 代理</li> <li>Cglib 代理也叫作子类代理,它是在内存中构建一个子类对象从而实现对目标对象功能扩展,有些书也将 Cglib 代理归属到动态代理</li> <li>Cglib 是一个强大的高性能的代码生成包,它可以在运行期扩展 java 类与实现 java 接口.它广泛的被许多 AOP 的框架使用,例如 SpringAOP，实现方法拦截</li> <li>在 AOP 编程中如何选择代理模式：
<ul><li>目标对象需要实现接口，用 JDK 代理</li> <li>目标对象不需要实现接口，用 Cglib 代理</li></ul></li> <li>Cglib 包的底层是通过使用<strong>字节码处理框架 ASM</strong>来转换字节码并生成新的类</li></ul> <h4 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h4> <p>==<strong>没有实现接口的对象也能被代理。</strong>==</p> <h4 id="代码-2"><a href="#代码-2" class="header-anchor">#</a> 代码</h4> <p>代理工厂代码，需要通过调用 cglib 中的<strong>Enhancer 类</strong>来创建对象。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">proxy<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>cglib</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">Enhancer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodInterceptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodProxy</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyFactory</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span>

	<span class="token comment">//维护一个目标对象</span>
	<span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>

	<span class="token comment">//构造器，传入一个被代理的对象</span>
	<span class="token keyword">public</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//返回一个代理对象:  是 target 对象的代理对象</span>
	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxyInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//1. 创建一个工具类</span>
		<span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//2. 设置父类</span>
		enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//3. 设置回调函数</span>
		enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//4. 创建子类对象，即代理对象</span>
		<span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token comment">//重写  intercept 方法，会调用目标对象的方法</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> arg0<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> arg3<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO Auto-generated method stub</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Cglib代理模式 ~~ 开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Object</span> returnVal <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Cglib代理模式 ~~ 提交&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> returnVal<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dec1967b.js" defer></script><script src="/assets/js/2.9efafe32.js" defer></script><script src="/assets/js/11.9f783c45.js" defer></script>
  </body>
</html>
